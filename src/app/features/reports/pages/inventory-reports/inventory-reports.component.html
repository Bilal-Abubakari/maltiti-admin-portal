<div class="inventory-reports">
  <div class="page-header">
    <h1 class="page-title">
      <i class="pi pi-warehouse"></i>
      Inventory & Stock Reports
    </h1>
    <p class="page-description">Monitor stock levels, inventory value, and low-stock alerts.</p>
  </div>

  <!-- Custom Filters for Inventory -->
  <div class="inventory-filters">
    <form class="filters-form" [formGroup]="filterForm">
      <div class="filters-grid">
        <div class="filter-field">
          <label for="category">Category</label>
          <p-select
            formControlName="category"
            inputId="category"
            placeholder="Select category"
            [options]="categories"
            [showClear]="true"
          />
        </div>

        <div class="filter-field">
          <label for="productId">Product ID</label>
          <input
            formControlName="productId"
            id="productId"
            pInputText
            placeholder="Enter product ID"
            type="text"
          />
        </div>

        <div class="filter-field">
          <label for="lowStockThreshold">Low Stock Threshold</label>
          <p-input-number
            formControlName="lowStockThreshold"
            inputId="lowStockThreshold"
            [min]="0"
            [showButtons]="true"
          />
        </div>

        <div class="filter-field checkbox-field">
          <p-checkbox formControlName="lowStockOnly" inputId="lowStockOnly" [binary]="true" />
          <label for="lowStockOnly">Show Low Stock Only</label>
        </div>
      </div>

      <div class="filter-actions">
        <p-button
          icon="pi pi-refresh"
          label="Reset"
          severity="secondary"
          [outlined]="true"
          (onClick)="onResetFilters()"
        />
        <p-button
          icon="pi pi-filter"
          label="Apply Filters"
          severity="primary"
          (onClick)="onApplyFilters()"
        />
      </div>
    </form>
  </div>

  @if (isLoading()) {
    <div class="loading-state">
      <p-skeleton height="150px" styleClass="mb-3" />
      <p-skeleton height="400px" />
    </div>
  } @else if (inventoryReport()) {
    <!-- Summary Cards -->
    <div class="kpi-cards">
      <p-card class="kpi-card">
        <div class="kpi-content">
          <div class="kpi-icon products">
            <i class="pi pi-box"></i>
          </div>
          <div class="kpi-details">
            <span class="kpi-label">Total Products</span>
            <span class="kpi-value">{{ inventoryReport()!.summary.totalProducts | number }}</span>
          </div>
        </div>
      </p-card>

      <p-card class="kpi-card">
        <div class="kpi-content">
          <div class="kpi-icon value">
            <i class="pi pi-dollar"></i>
          </div>
          <div class="kpi-details">
            <span class="kpi-label">Stock Value</span>
            <span class="kpi-value">{{
              inventoryReport()!.summary.totalStockValue | currency: 'GHS '
            }}</span>
          </div>
        </div>
      </p-card>

      <p-card class="kpi-card">
        <div class="kpi-content">
          <div class="kpi-icon units">
            <i class="pi pi-hashtag"></i>
          </div>
          <div class="kpi-details">
            <span class="kpi-label">Total Units</span>
            <span class="kpi-value">{{ inventoryReport()!.summary.totalUnits | number }}</span>
          </div>
        </div>
      </p-card>

      <p-card class="kpi-card">
        <div class="kpi-content">
          <div class="kpi-icon low-stock">
            <i class="pi pi-exclamation-triangle"></i>
          </div>
          <div class="kpi-details">
            <span class="kpi-label">Low Stock Items</span>
            <span class="kpi-value">{{ inventoryReport()!.summary.lowStockItems | number }}</span>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Inventory Table -->
    @if (inventoryReport()!.items.length > 0) {
      <p-card class="table-card">
        <ng-template pTemplate="header">
          <h3 class="card-title">Inventory Details</h3>
        </ng-template>
        <p-table
          [paginator]="true"

          [rows]="15"
          [value]="inventoryReport()!.items"
        >
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="productName">
                Product Name <p-sortIcon field="productName" />
              </th>
              <th pSortableColumn="category">
                Category <p-sortIcon field="category" />
              </th>
              <th pSortableColumn="currentStock">
                Current Stock <p-sortIcon field="currentStock" />
              </th>
              <th pSortableColumn="unitPrice">
                Unit Price <p-sortIcon field="unitPrice" />
              </th>
              <th pSortableColumn="inventoryValue">
                Inventory Value <p-sortIcon field="inventoryValue" />
              </th>
              <th pSortableColumn="isLowStock">Status</th>
            </tr>
          </ng-template>
          <ng-template let-item pTemplate="body">
            <tr [class.low-stock-row]="item.isLowStock">
              <td>{{ item.productName }}</td>
              <td>
                <span class="category-badge">{{ item.category }}</span>
              </td>
              <td>{{ item.currentStock | number }}</td>
              <td>{{ item.unitPrice | currency: 'GHS ' }}</td>
              <td>{{ item.inventoryValue | currency: 'GHS ' }}</td>
              <td>
                <p-tag
                  [severity]="item.isLowStock ? 'warn' : 'success'"
                  [value]="item.isLowStock ? 'Low Stock' : 'Normal'"
                />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-card>
    }
  } @else {
    <div class="empty-state">
      <i class="pi pi-warehouse"></i>
      <h3>No Inventory Data Available</h3>
      <p>Apply filters to view inventory reports</p>
    </div>
  }
</div>

