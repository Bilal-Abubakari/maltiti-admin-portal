<div class="audit-logs-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Audit Logs</h1>
    <p class="subtitle">View and analyze system activity</p>
  </div>

  <!-- Filters Section -->
  <app-audit-filters
    [initialFilters]="filters()"
    (filtersChange)="onFiltersChange($event)"
    (resetFilters)="onFiltersReset()"
  />

  <!-- Content Section -->
  <p-card>
    <!-- Loading State -->
    @if (isLoading()) {
      <div class="loading-container">
        <p-progressSpinner />
        <p>Loading audit logs...</p>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <p-message severity="error" [text]="error()!" />
    }

    <!-- Empty State -->
    @if (isEmpty()) {
      <div class="empty-state">
        <i class="pi pi-inbox empty-icon"></i>
        <h3>No Audit Logs Found</h3>
        <p>No audit records match the current filters.</p>
      </div>
    }

    <!-- Data Table -->
    @if (hasData() && !isLoading()) {
      <p-table
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        responsiveLayout="scroll"
        styleClass="p-datatable-striped"
        [paginator]="true"
        [rows]="filters().limit || 20"
        [rowsPerPageOptions]="[10, 20, 50, 100]"
        [showCurrentPageReport]="true"
        [totalRecords]="auditLogs().length"
        [value]="auditLogs()"
        (onPage)="onPageChange($event)"
      >
        <!-- Table Header -->
        <ng-template pTemplate="header">
          <tr>
            @for (col of columns(); track col.field) {
              <th [pSortableColumn]="col.sortable ? col.field : ''">
                {{ col.header }}
                @if (col.sortable) {
                  <p-sortIcon [field]="col.field" />
                }
              </th>
            }
            <th style="width: 80px">Actions</th>
          </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template let-log pTemplate="body">
          <tr class="audit-row">
            <!-- Timestamp -->
            <td>
              <span class="timestamp">
                {{ log.timestamp | date: 'short' }}
              </span>
            </td>

            <!-- User -->
            <td>
              <div class="user-info">
                <strong>{{ log.performedByUserName || 'Unknown' }}</strong>
                @if (log.performedByUserId) {
                  <small class="user-id">{{ log.performedByUserId }}</small>
                }
              </div>
            </td>

            <!-- Role -->
            <td>
              <p-tag
                severity="secondary"
                [value]="formatEnumLabel(log.performedByRole)"
              />
            </td>

            <!-- Action Type -->
            <td>
              <p-tag
                [severity]="getActionSeverity(log.actionType)"
                [value]="formatEnumLabel(log.actionType)"
              />
            </td>

            <!-- Entity Type -->
            <td>
              <p-tag
                [severity]="getEntitySeverity(log.entityType)"
                [value]="formatEnumLabel(log.entityType)"
              />
            </td>

            <!-- Description -->
            <td>
              <span
                class="description"
                tooltipPosition="top"
                [pTooltip]="log.description"
              >
                {{ truncateText(log.description) }}
              </span>
            </td>

            <!-- Actions -->
            <td>
              <p-button
                icon="pi pi-eye"
                pTooltip="View Details"
                severity="info"
                size="small"
                tooltipPosition="left"
                [rounded]="true"
                [text]="true"
                (onClick)="onViewDetails(log)"
              />
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </p-card>
</div>

